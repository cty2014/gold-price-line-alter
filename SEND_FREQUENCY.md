# 發送頻率說明

## 📊 執行頻率

### GitHub Actions Workflow 執行頻率
- **執行間隔**: 每 10 分鐘執行一次
- **Cron 設定**: `*/10 * * * *` (UTC 時間)
- **說明**: GitHub Actions 會每 10 分鐘自動觸發一次 workflow

## 📨 通知發送頻率

### 1. 每日報告（日報表）
- **發送時間**: 台灣時間整點（00:00, 01:00, 02:00, ..., 23:00）
- **誤差範圍**: 允許 5 分鐘誤差（00:00-00:05, 01:00-01:05, ...）
- **發送條件**: 
  - 台灣時間的整點時間（分鐘數在 0-5 之間）
  - 或手動觸發 workflow
- **頻率**: 最多每小時 1 次（在整點時段）

**範例**:
- ✅ 台灣時間 09:00-09:05 → 會發送日報表
- ✅ 台灣時間 15:00-15:05 → 會發送日報表
- ❌ 台灣時間 09:10 → 不會發送（非整點時段）
- ❌ 台灣時間 15:30 → 不會發送（非整點時段）

### 2. 價格變化警報
- **觸發條件**: 價格變化超過 5%（相對於上次記錄的價格）
- **發送時機**: 立即發送（不限時間）
- **頻率**: 無限制（只要價格變化超過閾值就會發送）

**範例**:
- 上次價格: $2000
- 當前價格: $2100 → 變化 5% → ✅ 立即發送警報
- 當前價格: $2050 → 變化 2.5% → ❌ 不發送

### 3. 手動觸發
- **觸發方式**: 在 GitHub Actions 頁面手動點擊 "Run workflow"
- **發送時機**: 立即發送
- **頻率**: 無限制

## 📋 發送邏輯總結

| 觸發條件 | 發送頻率 | 說明 |
|---------|---------|------|
| 整點時間（台灣時間） | 每小時最多 1 次 | 00:00-00:05, 01:00-01:05, ..., 23:00-23:05 |
| 價格變化 ≥ 5% | 無限制 | 只要價格變化超過閾值就立即發送 |
| 手動觸發 | 無限制 | 隨時可以手動觸發發送報告 |

## ⚙️ 程式碼設定

### GitHub Actions Workflow
```yaml
schedule:
  - cron: '*/10 * * * *'  # 每10分鐘執行一次
```

### 主程序設定
```python
PRICE_CHANGE_THRESHOLD = 5.0  # 5% 的價格變化閾值

# 整點檢查（00:00-00:05, 01:00-01:05, ..., 23:00-23:05）
if 0 <= taiwan_minute <= 5:
    is_daily_report_time = True

# 決定是否發送通知
should_send = should_send_alert or is_daily_report_time or is_manual_trigger
```

## 📊 實際執行範例

### 情境 1: 正常運作（無價格變化）
- **09:00** (台灣時間) → ✅ 發送日報表
- **09:10** → ❌ 不發送（非整點）
- **09:20** → ❌ 不發送（非整點）
- **10:00** → ✅ 發送日報表
- **10:10** → ❌ 不發送（非整點）

### 情境 2: 價格大幅波動
- **09:00** → ✅ 發送日報表
- **09:15** → 價格變化 6% → ✅ 立即發送警報
- **09:25** → 價格變化 3% → ❌ 不發送
- **09:35** → 價格變化 7% → ✅ 立即發送警報
- **10:00** → ✅ 發送日報表

### 情境 3: 手動觸發
- **任何時間** → 手動觸發 → ✅ 立即發送報告

## ⚠️ 注意事項

1. **避免重複發送**: 
   - 系統會檢查是否為整點時段，避免在非整點時間發送日報表
   - 價格變化警報不受此限制

2. **時間基準**:
   - 日報表發送時間以**台灣時間（UTC+8）**為準
   - GitHub Actions 的 cron 使用 UTC 時間，但程式內部會轉換為台灣時間

3. **誤差處理**:
   - 考慮到 GitHub Actions 的執行延遲，允許 5 分鐘的誤差範圍
   - 這確保即使 workflow 執行稍有延遲，仍能在整點時段發送

4. **價格變化計算**:
   - 價格變化是相對於**上次記錄的價格**計算
   - 不是相對於開盤價或當日最高/最低價

## 🔧 如何修改發送頻率

### 修改執行頻率（GitHub Actions）
編輯 `.github/workflows/gold-price-check.yml`:
```yaml
schedule:
  - cron: '*/10 * * * *'  # 改為其他間隔，例如 '*/5 * * * *' (每5分鐘)
```

### 修改價格變化閾值
編輯 `main.py`:
```python
PRICE_CHANGE_THRESHOLD = 5.0  # 改為其他值，例如 3.0 (3%)
```

### 修改整點發送時間
編輯 `main.py`:
```python
# 整點檢查（00:00-00:05, 01:00-01:05, ..., 23:00-23:05）
if 0 <= taiwan_minute <= 5:  # 改為其他範圍，例如 0 <= taiwan_minute <= 10
    is_daily_report_time = True
```

## 📈 預估通知數量

### 正常情況（無價格波動）
- **每日報告**: 24 次/天（每小時整點 1 次）
- **價格警報**: 0 次/天
- **總計**: 約 24 次/天

### 價格波動情況
- **每日報告**: 24 次/天
- **價格警報**: 視價格波動情況而定（可能 0-數十次）
- **總計**: 24+ 次/天

## ✅ 當前設定確認

- ✅ Workflow 執行頻率: 每 10 分鐘
- ✅ 日報表發送時間: 台灣時間整點（允許 5 分鐘誤差）
- ✅ 價格變化閾值: 5%
- ✅ 手動觸發: 已啟用

